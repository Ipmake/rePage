<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="" />
	<meta name="author" content="" />
	<meta name="robots" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="RePage, the free open sourse webserver" />
	<meta property="og:title" content="RePage Admin" />
	<meta property="og:description" content="RePage, the free open sourse webserver" />
	<meta property="og:image" content="https://cdn.ipgg.net/IPGsystems.png" />
	<meta name="format-detection" content="telephone=no">
	
	<!-- PAGE TITLE HERE -->
	<title>RePage Webserver</title>
	
	<!-- FAVICONS ICON -->
	<link rel="shortcut icon" type="image/png" href="images/logo.png" />
	<link href="./vendor/jquery-nice-select/css/nice-select.css" rel="stylesheet">
	<link href="./vendor/owl-carousel/owl.carousel.css" rel="stylesheet">
	
	<!-- Style css -->
    <link href="./css/style.css" rel="stylesheet">
	<link href="./css/gauge.css" rel="stylesheet">

	<link rel="stylesheet" href="./vendor/toastr/css/toastr.min.css">
    <link href="./vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">

	<!-- Required Scripts-->
	<script src="./vendor/sweetalert2/dist/sweetalert2.min.js"></script>

	
</head>
<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
		<div class="lds-ripple">
			<div></div>
			<div></div>
		</div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
		<div class="nav-header">
            <a href="/repage/dashboard.html" class="brand-logo">
				<img src="images/logo.png" class="logo-abbr">

				<div class="brand-title">
					<h2 class="">RePage</h2>
					<span class="brand-sub-title">RePage Webserver</span>
				</div>
            </a>
            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->
		
		<!--**********************************
            Header start
        ***********************************-->
        <div class="header border-bottom">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <div class="header-left">
							<div class="dashboard_bar">
                                Hosts
                            </div>
                        </div>
                        <ul class="navbar-nav header-right">
							<li class="nav-item dropdown header-profile">
                                <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                                    <img src="./images/user.png" width="20" alt=""/>
									<div class="header-info ms-3">
										<span class="fs-18 font-w500 mb-2" id="username"></span>
										<small class="fs-12 font-w400" id="group"></small>
                                        <script>
											window.onload = function() {
												if(!localStorage.getItem('username') || !localStorage.getItem('password') || !localStorage.getItem('group'))
												{
													swal({
														title: "Error, username or group invalid",
														text: "You will be redirected to the login page",
														timer: 30000,
														showConfirmButton: !1
													})
													setTimeout(() => {
														window.location.href = "/repage/login.html";
													}, 4000);
												}
                                            document.getElementById("username").innerHTML = localStorage.getItem("username");
                                            document.getElementById("group").innerHTML = localStorage.getItem("group");
											}
                                        </script>
									</div>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a href="/repage/change-password.html" class="dropdown-item ai-icon">
                                        <i class="fas fa-key"></i>
                                        <span class="ms-2">Change Password</span>
                                    </a>
                                    <a href="/repage/login.html" class="dropdown-item ai-icon">
                                        <svg id="icon-logout" xmlns="http://www.w3.org/2000/svg" class="text-danger" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                        <span class="ms-2">Logout </span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
				</nav>
			</div>
		</div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div class="dlabnav">
            <div class="dlabnav-scroll">
				<ul class="metismenu" id="menu">

					<li><a href="/repage/dashboard.html" class="" aria-expanded="false">
						<i class="fas fa-home"></i>
						<span class="nav-text">Dashboard</span>
					</a>
					</li>
					
                    <li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-globe"></i>
							<span class="nav-text">Pages</span>
						</a>
                        <ul id="GetPages" aria-expanded="false">
							<li><a href="/repage/hosts.html">Hosts</a></li>
							<li><a href="/repage/redirects.html">Redirects</a></li>
                        </ul>
                    </li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-chart-line"></i>
							<span class="nav-text">Analytics</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/pages-analytics.html">Pages</a></li>
							<li><a href="/repage/host-analytics.html">Hosts</a></li>
							<li><a href="/repage/redirects-analytics.html">Redirects</a></li>
						</ul>
					</li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-user"></i>
							<span class="nav-text">Users</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/users.html">Users</a></li>
							<li><a href="/repage/groups.html">Groups</a></li>
						</ul>
					</li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-cog"></i>
							<span class="nav-text">Settings</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/settings.html?config=/system">System</a></li>
							<li><a href="/repage/settings.html?config=/router">Router</a></li>
							<li><a href="/repage/settings.html?config=/logging">Logging</a></li>
						</ul>
					</li>
                </ul>
				

			</div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->
		
		<!--**********************************
            Content body start
        ***********************************-->

		<div class="content-body">
			<!-- Create a bootstrap data table -->
			<div class="row">
				<div class="col-12">
					<div class="card">
						<div class="card-body">
							<div class="card-title">
								<h3 class="text-center">Hosts</h3>
							</div>
							<!-- add an add button at the right side -->
							<div class="text-right" style="display:flex; justify-content: flex-end;">
								<a href="/repage/createhost.html" type="button" class="btn btn-primary" data-toggle="modal">
									<i class="fas fa-plus"></i>
									<span class="ml-2">Add Host</span>
								</a>
							</div>
							
							<div class="table-responsive">
								<table class="table header-border table-hover verticle-middle">
									<thead>
										<tr>
											<th scope="col">Host</th>
											<th scope="col">Directory</th>
											<th scope="col">SSL</th>
											<th scope="col">Owner</th>
											<th scope="col">Group</th>
											<th scope="col">Actions</th>
										</tr>
									</thead>
									<tbody id="hostlist">
										<!-- Hosts will be loaded here -->


									</tbody>
									<script>
										(async () => {
											const username = await localStorage.getItem("username");
											const password = await localStorage.getItem("password");

											if(!localStorage.getItem('username') || !localStorage.getItem('password')) document.location.href = '/repage/login.html';

											const hosts = document.getElementById('hostlist');

											var xhr = new XMLHttpRequest();
											xhr.open("POST", "/repage/api/hosts", true);
											xhr.setRequestHeader('Content-Type', 'application/json');
											xhr.send(JSON.stringify({
												username: username,
												password: password
											}));

											xhr.onload = function() {
												if (xhr.status === 200) {
													const response = JSON.parse(xhr.responseText)

													for(let c of response.hosts) {
														const tr = document.createElement('tr');
														const td1 = document.createElement('td');
														const td1a = document.createElement('a');
														const td2 = document.createElement('td');
														const td3 = document.createElement('td');
														const td4 = document.createElement('td');
														const td5 = document.createElement('td');
														const td6 = document.createElement('td');

														tr.id = c.host;

														td1a.innerHTML = c.host
														td1a.href = `http://${c.host}`;
														td1.appendChild(td1a)

														td2.innerHTML = c.dir;
														td3.innerHTML = c.SSL;
														td4.innerHTML = c.owner;
														td5.innerHTML = c.group;
														td6.innerHTML = `<a href="/repage/edithost.html?host=${c.host}" class="btn btn-primary btn-sm">Edit</a> <a onclick="deleteHost('${c.host}')" class="btn btn-danger btn-sm">Delete</a>`;


														tr.appendChild(td1);
														tr.appendChild(td2);
														tr.appendChild(td3);
														tr.appendChild(td4);
														tr.appendChild(td5);
														tr.appendChild(td6);

														hosts.appendChild(tr);
													}
												} else {
													console.log('Request failed. Returned status of ' + xhr.status);
													sweetAlert("Error", "There was an error trying to fetch your hosts", "error")
												}
											}
											})()
									</script>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			async function deleteHost(host){
				const username = await localStorage.getItem("username");
				const password = await localStorage.getItem("password");

				Swal.fire({
					title: "Are you sure sure?",
					text: "After deleting the host, it will stop receiving requests!",
					type: "warning",
					showCancelButton: !0,
					confirmButtonColor: "#DD6B55",
					confirmButtonText: "Yes, delete it!!"
				}).then(function(e) {
					if(!e.value) return;

					var xhr = new XMLHttpRequest();
					xhr.open("POST", "/repage/api/deletehost", true);
					xhr.setRequestHeader('Content-Type', 'application/json');
					xhr.send(JSON.stringify({
						username: username,
						password: password,
						host: host
					}));
					//log the returned statuses
					xhr.onload = function() {
						if (xhr.status === 200) {
								swal("Deleted!", "The host has been deleted.", "success")
								document.getElementById(host).remove();
						} else {
							console.log('Request failed. Returned status of ' + xhr.status);
							sweetAlert("Error", xhr.status + " - There was an error trying to delete the host", "error")
						}
					}

				})

				
			}
		</script>




        <!--**********************************
            Content body end
        ***********************************-->

		
        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>RePage WebServer developed by <a href="https://ipgg.net/github" target="_blank">IPGsystems</a> 2021</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


	</div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/chart.js/Chart.bundle.min.js"></script>
	<script src="vendor/jquery-nice-select/js/jquery.nice-select.min.js"></script>
	
	<!-- Apex Chart -->
	<script src="./vendor/apexchart/apexchart.js"></script>
	
	<script src="./vendor/chart.js/Chart.bundle.min.js"></script>
	
	<!-- Chart piety plugin files -->
    <script src="./vendor/peity/jquery.peity.min.js"></script>
	
	<script src="./vendor/owl-carousel/owl.carousel.js"></script>
	
    <script src="./js/custom.min.js"></script>
	<script src="./js/dlabnav-init.js"></script>

	<!-- SCRIPTS JS-->
	<script src="./vendor/toastr/js/toastr.min.js"></script>
	<script src="./js/autolert.js"></script>
</body>
</html>