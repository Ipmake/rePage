<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="" />
	<meta name="author" content="" />
	<meta name="robots" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="RePage, the free open sourse webserver" />
	<meta property="og:title" content="RePage Admin" />
	<meta property="og:description" content="RePage, the free open sourse webserver" />
	<meta property="og:image" content="https://cdn.ipgg.net/IPGsystems.png" />
	<meta name="format-detection" content="telephone=no">
	
	<!-- PAGE TITLE HERE -->
	<title>RePage Webserver</title>
	
	<!-- FAVICONS ICON -->
	<link rel="shortcut icon" type="image/png" href="images/logo.png" />
	<link href="./vendor/jquery-nice-select/css/nice-select.css" rel="stylesheet">
	<link href="./vendor/owl-carousel/owl.carousel.css" rel="stylesheet">
	
	<!-- Style css -->
    <link href="./css/style.css" rel="stylesheet">
	<link href="./css/gauge.css" rel="stylesheet">

	<link rel="stylesheet" href="./vendor/toastr/css/toastr.min.css">
    <link href="./vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">

	<!-- Required Scripts-->
	<script src="./vendor/sweetalert2/dist/sweetalert2.min.js"></script>

	
</head>
<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
		<div class="lds-ripple">
			<div></div>
			<div></div>
		</div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
		<div class="nav-header">
            <a href="/repage/dashboard.html" class="brand-logo">
				<img src="images/logo.png" class="logo-abbr">

				<div class="brand-title">
					<h2 class="">RePage</h2>
					<span class="brand-sub-title">RePage Webserver</span>
				</div>
            </a>
            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->
		
		<!--**********************************
            Header start
        ***********************************-->
        <div class="header border-bottom">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <div class="header-left">
							<div class="dashboard_bar">
                                Edit a host
                            </div>
                        </div>
                        <ul class="navbar-nav header-right">
							<li class="nav-item dropdown header-profile">
                                <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
                                    <img src="./images/user.png" width="20" alt=""/>
									<div class="header-info ms-3">
										<span class="fs-18 font-w500 mb-2" id="username"></span>
										<small class="fs-12 font-w400" id="group"></small>
                                        <script>
											window.onload = function() {
												if(!localStorage.getItem('username') || !localStorage.getItem('password') || !localStorage.getItem('group'))
												{
													swal({
														title: "Error, username or group invalid",
														text: "You will be redirected to the login page",
														timer: 30000,
														showConfirmButton: !1
													})
													setTimeout(() => {
														window.location.href = "/repage/login.html";
													}, 4000);
												}
                                            document.getElementById("username").innerHTML = localStorage.getItem("username");
                                            document.getElementById("group").innerHTML = localStorage.getItem("group");
											}
                                        </script>
									</div>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a href="/repage/change-password.html" class="dropdown-item ai-icon">
                                        <i class="fas fa-key"></i>
                                        <span class="ms-2">Change Password</span>
                                    </a>
                                    <a href="/repage/login.html" class="dropdown-item ai-icon">
                                        <svg id="icon-logout" xmlns="http://www.w3.org/2000/svg" class="text-danger" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                        <span class="ms-2">Logout </span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
				</nav>
			</div>
		</div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div class="dlabnav">
            <div class="dlabnav-scroll">
				<ul class="metismenu" id="menu">

					<li><a href="/repage/dashboard.html" class="" aria-expanded="false">
						<i class="fas fa-home"></i>
						<span class="nav-text">Dashboard</span>
					</a>
					</li>
					
                    <li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-globe"></i>
							<span class="nav-text">Pages</span>
						</a>
                        <ul id="GetPages" aria-expanded="false">
							<li><a href="/repage/hosts.html">Hosts</a></li>
							<li><a href="/repage/redirects.html">Redirects</a></li>
                        </ul>
                    </li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-chart-line"></i>
							<span class="nav-text">Analytics</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/pages-analytics.html">Pages</a></li>
							<li><a href="/repage/host-analytics.html">Hosts</a></li>
							<li><a href="/repage/redirects-analytics.html">Redirects</a></li>
						</ul>
					</li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-user"></i>
							<span class="nav-text">Users</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/users.html">Users</a></li>
							<li><a href="/repage/groups.html">Groups</a></li>
						</ul>
					</li>

					<li><a class="has-arrow " href="javascript:void()" aria-expanded="false">
						<i class="fas fa-cog"></i>
							<span class="nav-text">Settings</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="/repage/settings.html?config=/system">System</a></li>
							<li><a href="/repage/settings.html?config=/router">Router</a></li>
							<li><a href="/repage/settings.html?config=/logging">Logging</a></li>
						</ul>
					</li>
                </ul>
				

			</div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->
		
		<!--**********************************
            Content body start
        ***********************************-->

		<div class="content-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-body">
									<div class="card-title">
										<h3 class="text-center">Edit host</h3>
									</div>
									<div class="row">
										<div class="col-md-6 offset-md-3" style="display: flex; color: white; gap: 50px; flex-direction: column; ">
												<div class="form-group">
													<label for="hostname">Hostname</label>
													<input type="text" class="form-control" id="hostname" name="hostname" placeholder="Hostname">
												</div>
												<div class="form-group">
													<label for="directory">Directory in /www/</label>
													<input type="text" class="form-control" id="directory" name="directory" placeholder="Directory">
												</div>
												<div class="form-group">
													<label for="SSL">SSL</label>
													<select class="form-control" id="SSL" name="SSL">
														<option value="1">Yes</option>
														<option value="0">No</option>
													</select>
												</div>
											
												<button type="submit" onclick="send()" class="btn btn-primary">Save</button>

										</div>
									</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			window.onload = function() {
				var url = new URL(window.location.href);
				var args = url.searchParams;
				var hostname = args.get("host");

				console.log(hostname);
				
				//post request to the server
				var xhr = new XMLHttpRequest();
				xhr.open("POST", "/repage/api/gethost?host=" + hostname, true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var data = JSON.parse(this.responseText);
						console.log(data);
						document.getElementById("hostname").value = data.host;
						document.getElementById("directory").value = data.dir;
						document.getElementById("SSL").value = data.SSL ? 1 : 0;
					}
					else if(this.readyState == 4 && !this.status == 200) sweetAlert("Error", "Something went wrong!!", "error")
				};
				xhr.send(JSON.stringify({
					username: localStorage.getItem("username"),
					password: localStorage.getItem("password")
				}));

			}

			function send(){
				var url = new URL(window.location.href);
				var args = url.searchParams;
				var orighost = args.get("host");
				const hostname = document.getElementById("hostname").value;
				const directory = document.getElementById("directory").value;
				const SSL = document.getElementById("SSL").value;

				const username = localStorage.getItem("username");
				const password = localStorage.getItem("password");
				
				if(hostname == "" || directory == "" || SSL == ""){
					swal("Please fill in all fields")
				}else{
					var xhr = new XMLHttpRequest();
					xhr.open("POST", "/repage/api/edithost", true);
					xhr.setRequestHeader('Content-Type', 'application/json');

					xhr.send(JSON.stringify({
						origin: orighost,
						host: hostname, 
						dir: directory, 
						SSL: Boolean(Number(SSL)),

						username: username, 
						password: password
					}));

					xhr.onreadystatechange = function(){
						if(this.readyState == 4 && this.status == 200){
							const response = this.responseText;
							swal("Host Edited!!", "The hostname and directory have successfully been edited", "success")
							window.location.href = "/repage/hosts.html";
						}
					}

					xhr.ontimeout = function(){
						swal("Error", "The request timed out", "error")
					}

					xhr.onerror = function(){
						swal("Error", "There was an error with the request", "error")
					}
				}
			}
		</script>
						
		

        <!--**********************************
            Content body end
        ***********************************-->
		


		
        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>RePage WebServer developed by <a href="https://ipgg.net/github" target="_blank">IPGsystems</a> 2021</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->


	</div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script src="./vendor/global/global.min.js"></script>
	<script src="./vendor/chart.js/Chart.bundle.min.js"></script>
	<script src="vendor/jquery-nice-select/js/jquery.nice-select.min.js"></script>
	
	<!-- Apex Chart -->
	<script src="./vendor/apexchart/apexchart.js"></script>
	
	<script src="./vendor/chart.js/Chart.bundle.min.js"></script>
	
	<!-- Chart piety plugin files -->
    <script src="./vendor/peity/jquery.peity.min.js"></script>
	
	<script src="./vendor/owl-carousel/owl.carousel.js"></script>
	
    <script src="./js/custom.min.js"></script>
	<script src="./js/dlabnav-init.js"></script>

	<!-- SCRIPTS JS-->
	<script src="./vendor/toastr/js/toastr.min.js"></script>
	<script src="./js/autolert.js"></script>
</body>
</html>